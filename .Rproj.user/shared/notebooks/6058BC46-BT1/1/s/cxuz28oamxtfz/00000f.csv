"0","perm_test_two_mean <- function(.data, x, g, sign_grp = c(1, -1), R = 10000, alternative = c(""two_sided"", ""greater"", ""less"")) {"
"0","  alternative <- match.arg(alternative)"
"0","  "
"0","  # Calculate the observed statistic"
"0","  info_x <- .data |> group_by({{g}}) |> summarise(n = n(), mean_x = mean({{x}}), .groups = ""drop"")"
"0","  n <- sum(info_x$n)"
"0","  nA <- info_x$n[1]"
"0","  score <- .data |> pull({{x}})"
"0","  mean_diff <- sum(sign_grp * info_x$mean_x)"
"0","  "
"0","  # Generate the permutation distribution"
"0","  mean_diff_perm <- sapply(1:R, function(i) {"
"0","    idx_a <- sample(1:n, size = nA, replace = FALSE)"
"0","    idx_b <- setdiff(1:n, idx_a)"
"0","    res <- sum(sign_grp * c(mean(score[idx_a]), mean(score[idx_b])))"
"0","  })"
"0","  "
"0","  # Calculate p-value based on the alternative hypothesis"
"0","  p_val <- switch(alternative,"
"0","    ""two_sided"" = mean(abs(mean_diff_perm) >= abs(mean_diff)),"
"0","    ""greater""   = mean(mean_diff_perm > mean_diff),"
"0","    ""less""      = mean(mean_diff_perm < mean_diff)"
"0","  )"
"0","  "
"0","  return(list("
"0","    mean_diff = mean_diff,"
"0","    mean_diff_perm = tibble(out_perm = mean_diff_perm),"
"0","    p_val = p_val,"
"0","    alternative = alternative"
"0","  ))"
"0","}"
