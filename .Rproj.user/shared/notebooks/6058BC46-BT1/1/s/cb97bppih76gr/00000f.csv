"0","perm_test_var_ratio <- function(.data, x, g, R = 10000, alternative = c(""two_sided"", ""greater"", ""less"")) {"
"0","  alternative <- match.arg(alternative)"
"0","  "
"0","  # Calculate observed statistic"
"0","  info <- .data |> group_by({{g}}) |> summarise(var_x = var({{x}}), .groups = ""drop"")"
"0","  var_ratio_obs <- info$var_x[2] / info$var_x[1] "
"0","  "
"0","  # Generate permutation distribution"
"0","  score <- .data |> pull({{x}})"
"0","  group <- .data |> pull({{g}})"
"0","  n <- length(score)"
"0","  nA <- sum(group == unique(group)[1]) "
"0","  "
"0","  var_ratio_perm <- replicate(R, {"
"0","    perm_idx <- sample(1:n)"
"0","    group_perm <- rep(NA, n)"
"0","    group_perm[perm_idx[1:nA]] <- ""A""    "
"0","    group_perm[perm_idx[(nA+1):n]] <- ""B"" "
"0","    "
"0","    df <- tibble(x = score, g = group_perm)"
"0","    vars <- df |> group_by(g) |> summarise(var_x = var(x), .groups = ""drop"") "
"0","    vars$var_x[2] / vars$var_x[1] "
"0","  })"
"0","  "
"0","  # Calculate p-value"
"0","  p_val <- switch(alternative,"
"0","    ""two_sided"" = mean(var_ratio_perm >= var_ratio_obs | var_ratio_perm <= 1 / var_ratio_obs),"
"0","    ""greater""   = mean(var_ratio_perm > var_ratio_obs), "
"0","    ""less""      = mean(var_ratio_perm < var_ratio_obs)  "
"0","  )"
"0","  "
"0","  return(list("
"0","    var_ratio = var_ratio_obs, "
"0","    var_ratio_perm = tibble(ratio = var_ratio_perm),"
"0","    p_val = p_val,"
"0","    alternative = alternative"
"0","  ))"
"0","}"
