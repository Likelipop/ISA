---
title: "Uncovering Key Drivers of Diabetes Status"
subtitle: "A Statistical Analysis of the BRFSS Health Indicators Dataset"
author: "Nguyễn Thị Ngọc Anh, Trần Tiến Đạt, Nguyễn Thái Hưng Thịnh"
date: "`r Sys.Date()`"
output: 
  html_document:
    theme: cerulean
    toc: true
    toc_float: true
---

# 1. Introduction

Diabetes is currently one of the most prevalent chronic diseases worldwide, posing a significant burden on individuals, healthcare systems, and public health infrastructures. Numerous studies have been conducted to analyze diabetes risk, progression, and associated complications, with many of them focusing on statistical analyses or traditional risk factors. However, a major challenge remains: identifying individuals at high risk of diabetes early enough to enable timely intervention.

Early diagnosis of diabetes can facilitate lifestyle modifications and more effective treatment strategies, thereby reducing the risk of more severe complications. For this reason, predictive models for diabetes risk have become increasingly important tools for various clinic and health survices, as well as decrease the time and pressure on health sectors.

The objective of this project is to investigate how diabetes risk varies across different demographic groups and lifestyle patterns, and to identify the most important health-related predictors of diabetes. Specifically, the study seeks to understand how diabetes prevalence differs by age and gender, and whether access to healthcare is associated with diabetes outcomes. In addition, the analysis examines how lifestyle behaviors—such as unhealthy habits (e.g., smoking, physical inactivity) and positive habits (e.g., regular exercise, healthy diet)—influence the risk of developing diabetes. The project also evaluates whether key clinical risk factors, including obesity status and cholesterol levels, differ significantly between individuals with and without diabetes using comparative statistical analyses. After ensuring data quality through preprocessing steps such as handling missing values and checking multicollinearity, several machine learning models will be trained using health indicators to predict diabetes status. The importance of each risk factor will be quantified to determine which variables contribute most strongly to diabetes prediction, providing practical insights for early risk assessment and prevention strategies.

------------------------------------------------------------------------

# 2. Dataset

## 2.1 Context

Building upon previous public health studies that rely on large-scale survey data, this report makes use of the **2015 Behavioral Risk Factor Surveillance System (BRFSS)**, an annual health monitoring program conducted by the Centers for Disease Control and Prevention (CDC) in the United States. The BRFSS is designed to capture information on health-related behaviors, chronic disease prevalence, and access to preventive health services among adults aged 18 years and older across all U.S. states and selected territories.

Data are collected through standardized telephone-based surveys, including both landline and mobile phones, and are administered by state health departments following protocols developed by the CDC. The collected responses are subsequently aggregated, cleaned, and standardized to support population-level analyses in public health and epidemiology.

The variables in the dataset are primarily based on self-reported information provided by survey participants. In particular, variables related to disease status reflect whether respondents had previously been diagnosed by a physician or other health care professional, rather than being derived from direct clinical measurements. Additionally, certain composite indicators, such as body mass index (BMI), are calculated from self-reported personal information, including height and weight.

The original dataset contain three files: 1. diabetes \_ 012 \_ health \_ indicators \_ BRFSS2015.csv 2. diabetes \_ binary \_ 5050split \_ health \_ indicators \_ BRFSS2015.csv 3. diabetes \_ binary \_ health \_ indicators \_ BRFSS2015.csv In this project we mainly focus on the first one :"diabetes \_ 012 \_ health \_ indicators \_ BRFSS2015.csv"

The original BRFSS 2015 dataset is publicly available and can be accessed at: <https://www.cdc.gov/brfss/annual_data/annual_2015.html>

## 2.2 Content

diabetes \_ 012 \_ health \_ indicators \_ BRFSS2015.csv is a clean dataset of 253,680 survey responses to the CDC's BRFSS2015. The target variable Diabetes_012 has 3 classes. 0 is for no diabetes or only during pregnancy, 1 is for prediabetes, and 2 is for diabetes. There is class imbalance in this dataset. This dataset has 21 feature variables and 1 target variable (Diabetes_012), includes:

-   **Diabetes_012**: diabetes status (no diabetes / prediabetes / diabetes)
-   **HighBP**: whether the individual has high blood pressure
-   **HighChol**: whether the individual has high cholesterol
-   **CholCheck**: cholesterol check within the past 5 years
-   **BMI**: body mass index calculated from height and weight
-   **Smoker**: smoking status of the individual
-   **Stroke**: history of stroke
-   **HeartDiseaseorAttack**: history of heart disease or heart attack
-   **PhysActivity**: whether the individual engages in physical activity
-   **Fruits**: fruit consumption behavior
-   **Veggies**: vegetable consumption behavior
-   **HvyAlcoholConsump**: heavy alcohol consumption indicator
-   **AnyHealthcare**: access to health care services
-   **NoDocbcCost**: inability to see a doctor due to cost
-   **GenHlth**: self-reported general health status
-   **MentHlth**: number of days of poor mental health
-   **PhysHlth**: number of days of poor physical health
-   **DiffWalk**: difficulty in walking or climbing stairs
-   **Sex**: gender of the individual
-   **Age**: age group category
-   **Education**: highest education level
-   **Income**: income level category

The below section will discover more on these variables.

------------------------------------------------------------------------

# 3. Data Preparation

In this section, we about to take a look at ours data structures, extract most overall information of this dataset, then we perform several analysis and cleaning process to make sure the data is reliable for later use.

## 3.1 Overall

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(reshape2)  # for melt()
library(patchwork)
library(fastDummies)
```

First, we load the data and take a quick look at its overview.

```{r}
data <- read_csv("diabetes_012_health_indicators_BRFSS2015.csv")

glimpse(data)
```

## 3.2 Summarization

**Numeric Vars** First we filter out features having more than 20 different values and consider it as numeric features.

```{r}
numeric_vars <- data |>
  select(where(is.numeric)) |>
  select(where(~ n_distinct(., na.rm = TRUE) > 20)) |> 
  names()

numeric_vars
```

Although the Age variable in the BRFSS dataset is numerically coded, it represents ordinal age categories rather than exact age measured in years. As a result, the numerical codes do not correspond to a continuous scale with equal intervals, which is a key requirement for variables treated as numeric. Therefore, Age is not included among numeric variables and is instead analyzed as a categorical variable to ensure appropriate statistical interpretation.

**Descriptive Statistics for Numeric Variables**

```{r}
num_stats <- data %>%
  summarise(across(
    all_of(numeric_vars),
    list(
      n = ~ sum(!is.na(.)),
      missing = ~ sum(is.na(.)),
      mean = ~ mean(., na.rm = TRUE),
      sd = ~ sd(., na.rm = TRUE),
      median = ~ median(., na.rm = TRUE),
      IQR = ~ IQR(., na.rm = TRUE),
      min = ~ min(., na.rm = TRUE),
      max = ~ max(., na.rm = TRUE)
    ),
    .names = "{.col}__{.fn}"
  )) %>%
  pivot_longer(everything(),
               names_to = c("Variable", "Statistic"),
               names_sep = "__",
               values_to = "Value") %>%
  pivot_wider(names_from = Statistic, values_from = Value)

num_stats
```

Overall, BMI shows substantial variability and extreme values, while MentHlth and PhysHlth are highly right-skewed, with most respondents reporting zero unhealthy days and a small group driving the higher means.

**Categorical Vars**

In contrast, we might filter the rest of the columns as categoricals.

```{r}
categorical_vars <- data %>%
  select(1:22) %>%                      
  select(where(is.factor) | where(is.character) |
           where(~ is.numeric(.) && n_distinct(., na.rm = TRUE) <= 20)) %>%
  names()

categorical_vars <- setdiff(categorical_vars, numeric_vars)
categorical_vars
```

**Descriptive Statistics for Categorical Variables**

```{r}
cat_stats <- data %>%
  select(all_of(categorical_vars)) %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "Value") %>%
  group_by(Variable) %>%
  summarise(
    n = n(),
    n_missing = sum(is.na(Value)),
    n_levels = n_distinct(Value, na.rm = TRUE),

    mode = {
      tb <- sort(table(Value, useNA = "no"), decreasing = TRUE)
      if (length(tb) == 0) NA else names(tb)[1]
    },

    mode_count = {
      tb <- sort(table(Value, useNA = "no"), decreasing = TRUE)
      if (length(tb) == 0) NA_integer_ else as.integer(tb[1])
    },

    mode_pct = round(100 * mode_count / (n - n_missing), 2),
    .groups = "drop"
  )

cat_stats
```

Overall, most categorical variables are highly imbalanced, with one dominant mode accounting for a large majority of observations (often \> 80–90%). Age and socioeconomic variables show more spread across levels, while many health behavior and condition indicators are concentrated in a single category.

------------------------------------------------------------------------

# 4. Data Preprocessing

Data preprocessing is a critical step to improve data quality and ensure reliable analysis. In this study, the preprocessing stage addresses duplicate records, missing values, outliers, and class imbalance to reduce noise, limit bias, and prepare the dataset for effective modeling.

## 4.1. Duplicate Data Assessment

```{r}
# Number of fully duplicated rows
num_duplicates <- sum(duplicated(data))
num_duplicates

# Percentage of duplicated rows (%)
duplicate_rate <- num_duplicates / nrow(data) * 100
duplicate_rate
```

**Conclusion** The analysis indicates that the dataset contains 23,899 fully duplicated observations, accounting for 9.42% of the total number of records.

However, duplicated observations in terms of values do not necessarily imply repeated measurements of the same individual. Instead, they may represent different individuals sharing identical demographic characteristics, lifestyle factors, and health conditions. Removing these observations would unnecessarily reduce the sample size and could potentially distort the true population distribution, particularly for common health-related profiles.

Therefore, duplicated observations are retained to preserve the original distributional structure of the data, ensure the representativeness of the survey sample, and maintain the reliability of subsequent analyses.

## 4.2. Missing value

```{r}
missing_summary <- data.frame(
  MissingCount = colSums(is.na(data)),
  MissingRate  = colMeans(is.na(data)) * 100
)

missing_summary
```

**Conclusion**

The dataset contains no missing values across all 22 variables. Therefore, no missing data handling or imputation methods are required.

## 4.3. Outliers Assessment

### 4.3.1 BMI

**Density**

```{r}
ggplot(data, aes(x = BMI)) +
  geom_density(fill = "lightblue", alpha = 0.6) +
  labs(
    title = "Density plot of BMI",
    x = "BMI",
    y = "Density"
  ) +
  theme_bw()
```

The density plot of BMI shows a right-skewed distribution, with most observations concentrated around moderate BMI values and a long right tail indicating the presence of extremely high BMI cases.

**Boxplot**

```{r}
ggplot(data, aes(y = BMI)) +
  geom_boxplot(fill = "lightblue", outlier.color = "red", alpha = 0.7) +
  labs(
    title = "Boxplot of BMI",
    y = "BMI"
  ) +
  theme_bw()
```

The boxplot shows a narrow central distribution of BMI with numerous upper-end outliers, indicating cases of extremely high BMI.

**Case study**

To exams these outliers, we randomly drawl a few records from these and examine these cases.

```{r}
# Calculate bounds using summarise (tidyverse style)
bounds <- data %>%
  summarise(
    Q1 = quantile(BMI, 0.25, na.rm = TRUE),
    Q3 = quantile(BMI, 0.75, na.rm = TRUE),
    IQR = IQR(BMI, na.rm = TRUE)
  ) %>%
  mutate(
    lower = Q1 - 1.5 * IQR,
    upper = Q3 + 1.5 * IQR
  )

cat("Lower bound:", bounds$lower, "\nUpper bound:", bounds$upper, "\n")

result_df <- data %>%
  filter(BMI < bounds$lower | BMI > bounds$upper) %>%
  mutate(Outlier_Type = if_else(BMI > bounds$upper, "High_Outlier", "Low_Outlier")) %>%
  group_by(Outlier_Type) %>%
  slice_sample(n = 5) %>%
  ungroup()

# Print the final tibble
head(result_df,n = 10)
```

As the figure suggested, super obese people might have the tendancy of difficult to walk. and are likely to have High blood pressure as well. This trend might indicate that these data is not anomalies, that just extremes values. There fore, there is no needs to remove these values because it might encapsulate some importance informations for later analytical phrases.

**BMI Groups**

From above, we decided to group out these values into bins, based on guide on WHO on [Adult BMI Categories](https://www.cdc.gov/bmi/adult-calculator/bmi-categories.html), we will divide ours data into 5 groups, namely: 1. Underweight 2. Normal 3. Overweight 4. Obese 5. Unknown

```{r}
data <- data %>%
  mutate(
    BMI_group = case_when(
    BMI < 18.5 ~ "Underweight",
    BMI >= 18.5 & BMI < 25 ~ "Normal",
    BMI >= 25 & BMI < 30 ~ "Overweight",
    BMI >= 30 ~ "Obese",
    TRUE ~ "Unknown"
    )
  )

ggplot(data, aes(x = BMI_group)) +
  geom_bar(fill = "lightblue") +
  labs(
    title = "BMI categories based on WHO classification",
    x = "BMI category",
    y = "Count"
  ) +
  theme_bw()
```

The BMI distribution is dominated by the overweight and obese categories, while underweight individuals represent a very small proportion of the sample.

**Conclusion**

Outliers were not removed from the dataset. Case-based inspection combined with boxplot analysis indicated that extreme values represent severe obesity rather than data errors. These observations are meaningful and may substantially influence health-related analyses; therefore, they were retained in the study.

### 4.3.1 PhysHlth

**Density**

```{r}
ggplot(data, aes(x = PhysHlth)) +
  geom_density(fill = "lightgreen", alpha = 0.6) +
  labs(
    title = "Density plot of PhysHlth",
    x = "Number of poor physical health days",
    y = "Density"
  ) +
  theme_bw()
```

The density plot of PhysHlth shows a strongly right-skewed distribution with a sharp peak at zero, indicating that most individuals reported no days of poor physical health, while a small proportion experienced extended periods of physical health problems.

**Boxplot**

```{r}
ggplot(data, aes(y = PhysHlth)) +
  geom_boxplot(fill = "lightgreen", outlier.color = "red", alpha = 0.7) +
  labs(
    title = "Boxplot of PhysHlth",
    y = "PhysHlth"
  ) +
  theme_bw()
```

The boxplot reveals a highly right-skewed distribution with numerous upper-end outliers. These extreme values correspond to individuals reporting many days of poor physical health.

**PhysHlth Groups**

```{r}
data <- data %>%
  mutate(
    PhysHlth_group = case_when(
      PhysHlth == 0 ~ "0 days",
      PhysHlth <= 7 ~ "1–7 days",
      PhysHlth <= 14 ~ "8–14 days",
      PhysHlth <= 30 ~ "15–30 days",
      TRUE ~ NA_character_
    )
  )

ggplot(data, aes(x = PhysHlth_group)) +
  geom_bar(fill = "lightgreen") +
  labs(
    title = "Physical health status by number of poor-health days",
    x = "PhysHlth category",
    y = "Count"
  ) +
  theme_bw()
```

-   **0 days**: No poor physical health
-   **1--7 days**: Mild
-   **8--14 days**: Moderate
-   **15--30 days**: Severe

The categorical distribution shows that the majority of respondents reported zero days of poor physical health, while progressively fewer individuals fall into higher-duration categories, indicating that severe physical health issues affect a relatively small subset of the population.

**Conclusion**

Taken together, the density plot, boxplot, and categorical distribution of PhysHlth indicate that extreme values are rare but meaningful. These observations reflect prolonged periods of poor physical health rather than data errors. Consequently, removing such values could underestimate the burden of physical health problems, and the outliers were therefore retained in the analysis.

### 4.3.1 MentHlth

**Density**

```{r}
ggplot(data, aes(x = MentHlth)) +
  geom_density(fill = "lightcoral", alpha = 0.6) +
  labs(
    title = "Density plot of MentHlth",
    x = "Number of poor mental health days",
    y = "Density"
  ) +
  theme_bw()
```

The density plot of PhysHlth shows a strong right-skewed distribution with a sharp peak at zero, indicating that most individuals reported no days of poor physical health. A long right tail suggests the presence of a small group experiencing prolonged physical health issues.

**Boxplot**

```{r}
ggplot(data, aes(y = MentHlth)) +
  geom_boxplot(fill = "lightcoral", outlier.color = "red", alpha = 0.7) +
  labs(
    title = "Boxplot of MentHlth",
    y = "MentHlth"
  ) +
  theme_bw()
```

The boxplot of MentHlth reveals a highly right-skewed distribution with numerous high-end outliers. While most observations are concentrated near zero, the outliers represent individuals reporting extended periods of poor mental health.

**MentHlth Groups**

```{r}
data <- data %>%
  mutate(
    MentHlth_group = case_when(
      MentHlth == 0 ~ "0 days",
      MentHlth <= 7 ~ "1–7 days",
      MentHlth <= 14 ~ "8–14 days",
      MentHlth <= 30 ~ "15–30 days",
      TRUE ~ NA_character_
    )
  )

ggplot(data, aes(x = MentHlth_group)) +
  geom_bar(fill = "lightcoral") +
  labs(
    title = "Mental health status by number of poor-health days",
    x = "MentHlth category",
    y = "Count"
  ) +
  theme_bw()
```

-   **0 days**: No poor mental health
-   **1--7 days**: Mild
-   **8--14 days**: Moderate
-   **15--30 days**: Severe

The categorical distribution shows that the majority of individuals reported zero days of poor mental health, while progressively fewer individuals fall into higher-duration categories, indicating that severe mental health issues affect a smaller subset of the population.

**Conclusion**

Taken together, the density plot, boxplot, and categorical distribution of MentHlth show that extreme values are rare but meaningful. These observations represent individuals experiencing prolonged periods of poor mental health rather than data errors. Consequently, removing such values could underestimate mental health burden, and the outliers were therefore retained in the analysis.

------------------------------------------------------------------------

# 5 Exploration and visualization

## 5.1 Data grouping

Based on the meaning of each features, we shall split these features into three categorical, namely:

-   **Demographic and Social characteristics included:**
    -   Sex
    -   Age
    -   Education
    -   Income
    -   AnyHealthcare
    -   NoDocbcCos
    -   CholCheckt
-   **Behavioral factors comprised:**
    -   Smoker
    -   PhysActivity
    -   Fruits
    -   Veggies
    -   HvyAlcoholConsump
-   **Health status indicators included:**
    -   Diabetes_012
    -   HighBP
    -   HighChol
    -   BMI
    -   Stroke
    -   HeartDiseaseorAttack
    -   GenHlth
    -   MentHlth
    -   PhysHlth
    -   DiffWalk

Later analysis will focus on the relationship between these group to the diabetes status. At first, we will glimpse at each of the features to see its distributions.

## 5.2 Density/ distribution plot

### 5.2.1 Demographic and Social characteristics indicators

This dataset includes critical variables to assess socioeconomic status and healthcare access beyond basic demographics (such as age or gender,...). **Education** and **Income** categorize respondents based on schooling levels and earning ranges, while **AnyHealthcare** confirms the presence of health insurance. Additionally, **NoDocbcCost** tracks financial barriers to seeing a doctor, and **CholCheck** indicates whether a cholesterol screening has occurred recently.

```{r}
# --- 1. Education Variable ---
edu_labels <- c(
  "1" = "Never attended/Kindergarten",
  "2" = "Elementary",
  "3" = "Some high school",
  "4" = "High school graduate",
  "5" = "College 1-3 years",
  "6" = "College 4+ years"
)

# Plot Education (Categorical Bar Chart)
p_edu <- data %>%
  filter(!is.na(Education)) %>%
  ggplot(aes(x = factor(Education))) +
  geom_bar(fill = "steelblue") +
  scale_x_discrete(labels = edu_labels) +
  labs(title = "Distribution of Education Level", x = "Education Level", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(p_edu)

# --- 2. Income Variable ---
# Mapping based on the provided image
income_labels <- c(
  "1" = "< $10,000",
  "2" = "$10,000 - < $15,000",
  "3" = "$15,000 - < $20,000",
  "4" = "$20,000 - < $25,000",
  "5" = "$25,000 - < $35,000",
  "6" = "$35,000 - < $50,000",
  "7" = "$50,000 - < $75,000",
  "8" = ">= $75,000"
)

# Plot Income (Categorical Bar Chart)
p_inc <- data %>%
  filter(!is.na(Income)) %>%
  ggplot(aes(x = factor(Income))) +
  geom_bar(fill = "seagreen") +
  scale_x_discrete(labels = income_labels) +
  labs(title = "Distribution of Income", x = "Income Range", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(p_inc)

# --- 3. Age Variable ---

age_group_labels <- c(
  "1" = "18 - 24",
  "2" = "25 - 29",
  "3" = "30 - 34",
  "4" = "35 - 39",
  "5" = "40 - 44",
  "6" = "45 - 49",
  "7" = "50 - 54",
  "8" = "55 - 59",
  "9" = "60 - 64",
  "10" = "65 - 69",
  "11" = "70 - 74",
  "12" = "75 - 79",
  "13" = "80 or older"
)


# Assuming Age is continuous or ordinal 1-13 (standard BRFSS format)
p_age <- data %>%
  filter(!is.na(Age)) %>%
  ggplot(aes(x = factor(Age))) +
  geom_bar(fill = "orange", color = "white") + # Use geom_histogram if Age is raw numeric 18-99
  scale_x_discrete(labels = age_group_labels) +
  labs(title = "Distribution of Age", x = "Age Group", y = "Count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(p_age)
```

```{r}
# Function definition
draw_mono_charts <- function(data, var_vector, title1, title2) {
  
  plot_data <- data %>%
    select(all_of(var_vector)) %>%
    pivot_longer(cols = everything(), names_to = "Variable", values_to = "Value") %>%
    mutate(Value = as.factor(Value))
  
  # --- Chart 1: Amount (Side-by-side) ---
  p1 <- ggplot(plot_data, aes(x = Variable, fill = Value)) +
    geom_bar(position = "dodge") +
    geom_text(stat = "count", aes(label = ..count..), 
              position = position_dodge(width = 0.9), vjust = -0.5) +
    scale_fill_manual(
      values = c("0" = "forestgreen", "1" = "firebrick"),
      name = "Value"
    ) +
    labs(title = title1, x = "Variable", y = "Count") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  print(p1)
  
  # --- Chart 2: Fraction (Stacked %) ---
  # Calculate percentages
  plot_data_pct <- plot_data %>%
    count(Variable, Value) %>%
    group_by(Variable) %>%
    mutate(Percent = n / sum(n))
  
  p2 <- ggplot(plot_data_pct, aes(x = Variable, y = Percent, fill = Value)) +
    geom_col(position = "fill") +
    geom_text(aes(label = scales::percent(Percent, accuracy = 1)), 
              position = position_fill(vjust = 0.5), color = "white") +
    scale_y_continuous(labels = scales::percent) +
    scale_fill_manual(
      values = c("0" = "forestgreen", "1" = "firebrick"),
      name = "Value"
    ) +
    labs(title = title2, x = "Variable", y = "Percentage") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  print(p2)
}

```

```{r}
# 1. Define the vector
 access_to_healthServices <- c("AnyHealthcare","NoDocbcCost","CholCheck")

# 2. Call the function
draw_mono_charts(
  data = data, 
  var_vector = access_to_healthServices, 
  title1 = "Amount of each class of Accessment of Health Service Variable", 
  title2 = "Fraction of each class of Accessment of Health Service Variable"
)

```

As the figure suggested, more than 24000/25000 surveyed people have no difficulty in Healthcare Accessment.

### 5.2.2 Health Indicators

Furthermore, the dataset contains eight variables reflecting health status: HighBP, HighChol, BMI, Stroke, HeartDiseaseorAttack, GenHlth, MentHlth, PhysHlth, and DiffWalk. Apart from BMI, MentHlth, and PhysHlth, most of these serve as binary indicators, with the sole exception of GenHlth, which is a categorical variable consisting of five distinct levels.

```{r}
data <- data |> 
  dummy_cols(
    select_columns = c("BMI_group", "MentHlth_group", "PhysHlth_group"),
    remove_first_dummy = FALSE, 
    remove_selected_columns = FALSE
  )
```

Genhealth is a variable based on respondents’ self-reported assessments of their health, as described in the Behavioral Risk Factor Surveillance System (BRFSS) Codebook Report (2015), which asks: “Would you say that in general your health is…?”

The original complete version of this variable comprises eight categories: values 1 to 5 correspond to health conditions ranging from excellent to poor, while 7 indicates Don’t know/Not sure, 9 indicates Refused, and blank indicates that the respondent left the question unanswered.

In this version, the last three categories are excluded, leaving only values from 1 to 5, as shown below.

```{r}
# Convert GenHlth to factor with labels and plot
data %>% 
  mutate(GenHlth = factor(GenHlth, 
                          levels = 1:5, 
                          labels = c("Excellent", "Very Good", "Good", "Fair", "Poor"))) %>% 
  ggplot(aes(x = GenHlth, fill = GenHlth)) +
  geom_bar() +
  # Use RdYlGn palette: direction -1 reverses it so 1 (Excellent) is Green/Cool and 5 (Poor) is Red/Hot
  scale_fill_brewer(palette = "RdYlGn", direction = -1) + 
  labs(
    title = "Distribution of General Health Status",
    x = "General Health",
    y = "Count",
    fill = "Health Status"
  ) +
  theme_minimal()
```

```{r}
health_vars <- c( "HighBP", "HighChol", 
  "Stroke", "HeartDiseaseorAttack", "DiffWalk"
)
# 1. Define the vector
 access_to_healthServices <- c("AnyHealthcare","NoDocbcCost","CholCheck")

# 2. Call the function
draw_mono_charts(
  data = data, 
  var_vector = health_vars, 
  title1 = "Amount of each class of Indicators of Health Service Variable", 
  title2 = "Fraction of each class of Indicators of Health Service Variable"
)

```

### 5.2.3 Target variable: Diabetes_012

The variable Diabetes_012 is a categorical variable with three values: 0 (no diabetes), 1 (type 1 diabetes), and 2 (type 2 diabetes). First, we examine the distribution of each class.

```{r}
imbalance_report <- function(df, var_name, var_label = var_name) {
  # ---- Count Table  ----
  tab <- df %>%
    count(.data[[var_name]], name = "Count") %>%
    mutate(
      Percentage = round(Count / sum(Count) * 100, 2)
    ) %>%
    arrange(desc(Count)) %>%
    mutate(
      CumCount = cumsum(Count),
      CumPct = round(cumsum(Percentage), 2)
    )

# ---- Plot Count ----
p_count <- ggplot(tab, aes(x = factor(.data[[var_name]]), y = Count)) +
  geom_col(fill = "lightblue") +
  labs(
    title = paste("Class distribution (Count) -", var_label),
    x = var_label,
    y = "Count"
  ) +
  theme_bw()

# ---- Plot Percentage ----
p_pct <- ggplot(tab, aes(x = factor(.data[[var_name]]), y = Percentage)) +
  geom_col(fill = "lightblue") +
  scale_y_continuous(labels = function(x) paste0(x, "%")) +
  labs(
    title = paste("Class distribution (Percentage) -", var_label),
    x = var_label,
    y = "Percentage (%)"
  ) +
  theme_bw()

  # Result
  list(table = tab, plot_count = p_count, plot_pct = p_pct)
}
```

```{r}
res_diabetes <- imbalance_report(
  df = data,
  var_name = "Diabetes_012",
  var_label = "Diabetes status"
)

res_diabetes$table
res_diabetes$plot_count
res_diabetes$plot_pct
```

Overall, the Diabetes_012 variable is highly imbalanced: the majority of individuals report no diabetes (84.24%), while prediabetes (1.83%) and diabetes (13.93%) account for much smaller proportions of the dataset.

### 5.2.4 Lifestyles indicators

There are a total of five variables representing lifestyle habits. (1) Variables indicating positive lifestyle behaviors include Fruits, Veggies, and PhysActivity. (2) Variables indicating negative lifestyle behaviors include Smoker and HvyAlcoholConsum.

```{r}
# Define behavioral variables
behavioral_vars <- c("Smoker", "PhysActivity", "Fruits", "Veggies", "HvyAlcoholConsump")

# Reshape data to long format
plot_data <- data %>%
  select(all_of(behavioral_vars)) %>%
  pivot_longer(cols = everything(), names_to = "Variable", values_to = "Value") %>%
  mutate(Value = as.factor(Value))

# --- Chart 1: Amount of each class (Side-by-side with labels) ---
ggplot(plot_data, aes(x = Variable, fill = Value)) +
  geom_bar(position = "dodge") + # Side-by-side bars
  geom_text(stat = "count", aes(label = ..count..), 
            position = position_dodge(width = 0.9), vjust = -0.5) + # Add count labels
  scale_fill_manual(
    values = c("0" = "forestgreen", "1" = "darkblue"),
    name = "Value"
  ) +
  labs(
    title = "Amount of each class of Behavioral Variables",
    x = "Variable",
    y = "Count"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# --- Chart 2: Fraction of each class (100% Stacked Bar) ---
# Calculate percentages first
plot_data_pct <- plot_data %>%
  count(Variable, Value) %>%
  group_by(Variable) %>%
  mutate(Percent = n / sum(n))

ggplot(plot_data_pct, aes(x = Variable, y = Percent, fill = Value)) +
  geom_col(position = "fill") + # Stacked proportional bar
  geom_text(aes(label = scales::percent(Percent, accuracy = 1)), 
            position = position_fill(vjust = 0.5), color = "white") + # Add % labels
  scale_y_continuous(labels = scales::percent) +
  scale_fill_manual(
    values = c("0" = "forestgreen", "1" = "darkblue"),
    name = "Value"
  ) +
  labs(
    title = "Fraction of each class of Behavioral Variables",
    x = "Variable",
    y = "Percentage"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

As the figures suggested, about half of the interviewed people maintain a healthy habits (over 60% of people eat vegetables/ fruit regularly)

In speaking of bad habits, a small portions of people commit to heavy alchohol consumptions. and less than a half of surveyor smoke.

**Conclusion**

The dataset shows a clear class imbalance, particularly in diabetes status, where the majority class dominates. This imbalance may bias models toward the majority class and reduce predictive performance for clinically important minority groups. Therefore, class imbalance uses class-weighted algorithms rather than resampling methods such as oversampling, undersampling, or SMOTE. Model performance should be interpreted using metrics such as recall, F1-score, or ROC-AUC instead of accuracy alone.

## 5.3 Interaction

In this section, we about to analysis the link between each group factors to diabtetes. We categorize these factors by three different group mentioned above, namely: \* Demographic and Social characteristics \* Lifestyles/ habits behaviours \* Health indicators

#### 5.3.1 Demographic and Social characteristics

This subsection examines the correlations between: \* gender and diabetes \* age and diabetes, as well as the remaining sociodemographic variables related to the disease. Specifically, we analyze whether differences in gender and age groups are associated with variations in diabetes prevalence, and how other personal and social factors may contribute to this relationship. To visualize these patterns more clearly, a heatmap will also be generated to illustrate the strength and direction of the correlations among all sociodemographic variables and diabetes status.

**Sex**

```{r}
data %>%
  group_by(Sex, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(Sex) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2))
```

```{r}
# Prepare data with percentages for better labels
pie_data <- data %>%
  count(Sex, Diabetes_012) %>%       # Count occurrences
  group_by(Sex) %>%
  mutate(Percent = n / sum(n))       # Calculate percentage per Sex

# Draw Pie Chart
ggplot(pie_data, aes(x = "", y = Percent, fill = factor(Diabetes_012))) +
  geom_col(color = "white") +        # Use geom_col for pre-calculated values
  coord_polar("y", start = 0) +      # Convert bar to pie
  facet_wrap(~Sex, strip.position = "bottom",
             labeller = as_labeller(c("0" = "Female", "1" = "Male"))) +                 # Create separate pie for each Sex
  theme_void() +                     # Remove axes and background
  geom_text(aes(label = scales::percent(Percent, accuracy = 1)),
            position = position_stack(vjust = 0.5)) + # Add labels in center of slices
  labs(
    title = "Diabetes Status by Sex",
    fill = "Diabetes Status"
  )
```

Overall, the distribution of diabetes status is broadly similar across sexes, with non-diabetic individuals comprising the majority in both groups. However, the proportion of diabetes appears slightly higher in one sex, suggesting a modest association between sex and diabetes status that warrants further investigation in subsequent analyses.

**Diabetes by Age Group**

Then we draw the plots to see how much of each age group contributes to diabetes status.

```{r}

age_table <- data %>%
  mutate(
    AgeGroup = factor(
      case_when(
        Age %in% c(1, 2) ~ "<30",
        Age %in% c(3, 4, 5) ~ "30-44",
        Age %in% c(6, 7, 8) ~ "45-59",
        Age >= 9 ~ "60+"
      ),
      levels = c("<30", "30-44", "45-59", "60+")
    )
  ) %>%
  group_by(AgeGroup, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(AgeGroup) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

age_table
```

```{r}
ggplot(age_table,
       aes(x = AgeGroup, y = Percentage, fill = factor(Diabetes_012))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status by Age Group",
    x = "Age Group",
    y = "Proportion",
    fill = "Diabetes Status"
  )
```

Overall, the prevalence of diabetes increases markedly with age. Younger age groups are predominantly non-diabetic, while the proportions of prediabetes and diabetes rise steadily in middle-aged and older groups, with the highest prevalence observed among individuals aged 60 and above.

### 5.3.2 How Lifestyles affects diabetes

In this subsection, we interested in these questions : \* How diets relates to diabetes \* How bad habits like heavy alcoholics and smoking contribute to the diagnoise of diabetes After all, we will plots a heatmap to see a whole overall pictures about this

**Physical exercise and diabetes**

```{r}
phys_table <- data %>%
  group_by(PhysActivity, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(PhysActivity) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

phys_table
```

```{r}

phys_table <- phys_table %>%
  mutate(PhysActivity = ifelse(PhysActivity == 1, 
                               "who exercise regularly", 
                               "who do not exercise regularly"))

ggplot(phys_table,
       aes(x = PhysActivity, 
           y = Percentage, 
           fill = fct_rev(factor(Diabetes_012)))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status by exercise habits",
    x = "Class type ",
    y = "Proportion",
    fill = "Diabetes Status"
  )


```

As the figure suggested, people exercising regularly are less likely to have diabetes

**Healthy diets and diabetes**

First, we combine fruits and veggies to produce a features which is represent for those who regularly consume vegetables and fruits.

```{r}

data <- data %>%
  mutate(is_vegfruit = as.factor(Fruits * Veggies))

draw_mono_charts(
  data = data, 
  var_vector = c("is_vegfruit"), 
  title1 = "Amount of people who consume at least 1 green product a days ", 
  title2 = "Fraction of people who consume at least 1 green product a days"
)

```

```{r}

is_vegfruit_table <- data %>%
  mutate(is_vegfruit = ifelse(is_vegfruit == 1, "has Daily fruit/veg habit", "do not have Daily fruit/veg habit")) |>
  group_by(is_vegfruit, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(is_vegfruit) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

ggplot(is_vegfruit_table,
       aes(x = is_vegfruit, 
           y = Percentage, 
           fill = fct_rev(factor(Diabetes_012)))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status for those who eat green",
    x = "Class type ",
    y = "Proportion",
    fill = "Diabetes Status"
  )
```

As the figure suggested, in comparison with those who do not eat fruit regularly, people maintaining this habits seem to less likely to have diabetes.

**Alchoholics and diabetes**

```{r}
alchoholic_table <- data %>%
  group_by(HvyAlcoholConsump, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(HvyAlcoholConsump) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

alchoholic_table
```

```{r}
alchoholic_table <- data %>%
  mutate(HvyAlcoholConsump = ifelse(HvyAlcoholConsump == 1, "alcoholic person", "not an alcoholic person")) |>
  group_by(HvyAlcoholConsump, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(HvyAlcoholConsump) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

ggplot(alchoholic_table,
       aes(x = HvyAlcoholConsump, 
           y = Percentage, 
           fill = fct_rev(factor(Diabetes_012)))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status for alcoholic",
    x = "Class type ",
    y = "Proportion",
    fill = "Diabetes Status"
  )
```

The figure give us a hunch that people consuming alchoholic frequently might have a higher changes of diagnosed as diabetes.

**Smoking and diabetes**

```{r}
smoker_table <- data %>%
  group_by(Smoker, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(Smoker) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

smoker_table
```

```{r}
smoker_table <- data %>%
  mutate(Smoker = ifelse(Smoker == 1, "Chain smoker", " not a chain smoker")) |>
  group_by(Smoker, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(Smoker) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

ggplot(smoker_table,
       aes(x = Smoker, 
           y = Percentage, 
           fill = fct_rev(factor(Diabetes_012)))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status for chain smokers",
    x = "Class type ",
    y = "Proportion",
    fill = "Diabetes Status"
  )
```

There is a subtle different in the diabetes when comparing to those who smoke. but it still give us an intuition that those who smoke is likely to have diabetes but not as extreme as diabetes.

**Correlation**

```{r}
vars_to_plot <- c("Diabetes_012", "Smoker", "Fruits", "Veggies", "PhysActivity")

cor_data <- data %>%
  select(all_of(vars_to_plot)) %>%
  cor(use = "complete.obs") %>%
  as.data.frame() %>%
  rownames_to_column(var = "Var1") %>%
  pivot_longer(-Var1, names_to = "Var2", values_to = "Correlation")

ggplot(cor_data, aes(Var1, Var2, fill = Correlation)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1)) +
  geom_text(aes(label = round(Correlation, 2))) +
  theme_minimal() +
  labs(title = "Heatmap for habits and diabetes")
```

In general, the heatmap suggests that people maintaining good habits relate to each other. In contrast with those who smoke and drink, People in these group tend to have diabetes

### 5.3.3 Health indicators and diabetes

**Diabetes by BMI**

```{r}
bmi_table <- data  %>%
  group_by(BMI_group, Diabetes_012) %>%
  summarise(n = n(), .groups = "drop") %>%
  group_by(BMI_group) %>%
  mutate(Percentage = round(n / sum(n) * 100, 2)) %>%
  ungroup()

bmi_table
```

```{r}
ggplot(bmi_table, aes(x = BMI_group, y = n, fill = factor(Diabetes_012))) +
  geom_col(position = "fill") +
  theme_bw() +
  labs(
    title = "Diabetes Status by BMI Group",
    x = "BMI Group",
    y = "Proportion",
    fill = "Diabetes Status"
  )
```

Overall, the prevalence of diabetes increases with higher BMI categories. Underweight and normal-weight groups are largely non-diabetic, while overweight and especially obese individuals show substantially higher proportions of diabetes and prediabetes, indicating a strong positive association between BMI and diabetes status.

### 5.3.4 Life styles and health indicators

```{r}
vars_to_plot <- c("Diabetes_012", "HighChol", "HighBP", "HeartDiseaseorAttack", "BMI_group", "Smoker", "Fruits", "Veggies", "PhysActivity")

cor_data <- data %>%
  select(all_of(vars_to_plot)) %>%
  mutate(across(everything(), ~as.numeric(as.factor(.)))) %>%
  cor(use = "complete.obs") %>%
  as.data.frame() %>%
  rownames_to_column(var = "Var1") %>%
  pivot_longer(-Var1, names_to = "Var2", values_to = "Correlation")

ggplot(cor_data, aes(Var1, Var2, fill = Correlation)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1)) +
  geom_text(aes(label = round(Correlation, 2))) +
  theme_minimal() +
  labs(title = "Heatmap for habits and diabetes")+ 
  theme(
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
    panel.grid = element_blank()
  )
```
