knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# Lọc và Mô tả đặc điểm nổi bật
data_enviroment |>
select(Chlorine) |>
filter(!is.na(Chlorine)) |>
summarize(across(Chlorine, list(
mean = mean,
median = median,
sd = sd,
min = min,
max = max
), na.rm = TRUE,, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
# Quan sát dữ liệu
data_enviroment <- read.csv(file = "../datasets/Bangladesh.csv")
# Quan sát dữ liệu
data_enviroment <- read.csv(file = "../data/Bangladesh.csv")
# Quan sát dữ liệu
data_enviroment <- read.csv(file = "lab02/Code/data/Bangladesh.csv")
summary(data_enviroment)
str(data_enviroment)
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
max = max
), na.rm = TRUE, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
ggplot(data_enviroment |> filter(!is.na(Chlorine)),
aes(x = Chlorine)) +
geom_histogram(bins = 30) +
labs(title = "Phân bố hàm lượng Chlorine")
ggplot(data_enviroment |> filter(!is.na(Chlorine)),
aes(y = Chlorine)) +
geom_boxplot() +
labs(title = "Boxplot hàm lượng Chlorine")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
max = max
Q1 = ~quantile(., probs = 0.25, na.rm = TRUE),
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
max = max,
Q1 = ~quantile(., probs = 0.25, na.rm = TRUE),
Q3 = ~quantile(., probs = 0.75, na.rm = TRUE)
), na.rm = TRUE, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
Q1 = ~quantile(., probs = 0.25, na.rm = TRUE),
Q3 = ~quantile(., probs = 0.75, na.rm = TRUE),
max = max
), na.rm = TRUE, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
Q1 = ~quantile(., probs = 0.25),
Q3 = ~quantile(., probs = 0.75),
max = max
), na.rm = TRUE, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = ~mean(., na.rm = TRUE),
median = ~median(., na.rm = TRUE),
sd = ~sd(., na.rm = TRUE),
min = ~min(., na.rm = TRUE),
Q1 = ~quantile(., probs = 0.25, na.rm = TRUE),
Q3 = ~quantile(., probs = 0.75, na.rm = TRUE),
max = ~max(., na.rm = TRUE)
), .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = mean,
median = median,
sd = sd,
min = min,
Q1 = ~quantile(., probs = 0.25),
Q3 = ~quantile(., probs = 0.75),
max = max
), .na.rm = TRUE, .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
# Lọc và mô tả dữ liệu
data_enviroment |>
filter(!is.na(Chlorine)) |>
summarize(across(.cols = Chlorine, .fns = list(
mean = ~mean(., na.rm = TRUE),
median = ~median(., na.rm = TRUE),
sd = ~sd(., na.rm = TRUE),
min = ~min(., na.rm = TRUE),
Q1 = ~quantile(., probs = 0.25, na.rm = TRUE),
Q3 = ~quantile(., probs = 0.75, na.rm = TRUE),
max = ~max(., na.rm = TRUE)
), .names = "{.col}.{.fn}")) |>
pivot_longer(cols = everything(),
names_to = "variable",
values_to = "value")
boot_test_mean <- function(
x,
R = 5000,
alternative = c("two.sided", "greater", "less"),
seed = NULL
) {
alternative <- match.arg(alternative)
if (!is.null(seed)) set.seed(seed)
x <- x[!is.na(x)]
n <- length(x)
obs_mean <- mean(x)
x_tilde <- x - obs_mean
# Bootstrap samples
boot_means <- replicate(R, mean(sample(x_tilde, size = n, replace = TRUE)))
# p-value
p_val <- switch(
alternative,
"two.sided" = mean(abs(boot_means) >= abs(obs_mean)),
"greater"   = mean(boot_means > obs_mean),
"less"      = mean(boot_means < obs_mean)
)
list(
obs_mean  = obs_mean,
boot_means = boot_means,
p_value   = p_val,
alternative = alternative
)
}
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu0 = 0, R = 10000, alternative = "greater", seed = 123)
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, R = 10000, alternative = "greater", seed = 123)
res_boot$obs_mean
res_boot$p_value
# Histogram phân phối bootstrap
hist(res_boot$boot_means, breaks = 50, col = "skyblue",
main = "Bootstrap Distribution of Mean Chlorine",
xlab = "Mean Chlorine")
abline(v = res_boot$obs_mean, col = "red", lwd = 2)
boot_test_mean <- function(
x,
mu = 0,
R = 5000,
alternative = c("two.sided", "greater", "less"),
seed = NULL
) {
alternative <- match.arg(alternative)
if (!is.null(seed)) set.seed(seed)
x <- x[!is.na(x)]
n <- length(x)
obs_mean <- mean(x)
x_tilde <- x - obs_mean
# Bootstrap samples
boot_means <- replicate(R, mean(sample(x_tilde, size = n, replace = TRUE)))
# p-value
p_val <- switch(
alternative,
"two.sided" = mean(abs(boot_means) >= abs(obs_mean)),
"greater"   = mean(boot_means > obs_mean),
"less"      = mean(boot_means < obs_mean)
)
list(
obs_mean  = obs_mean,
boot_means = boot_means,
p_value   = p_val,
alternative = alternative
)
}
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu0 = 0, R = 10000, alternative = "greater", seed = 123)
boot_test_mean <- function(
x,
mu = 0,
R = 5000,
alternative = c("two.sided", "greater", "less"),
seed = NULL
) {
alternative <- match.arg(alternative)
if (!is.null(seed)) set.seed(seed)
x <- x[!is.na(x)]
n <- length(x)
obs_mean <- mean(x)
x_tilde <- x - mean(x) + mu
# Bootstrap samples
boot_means <- replicate(R, mean(sample(x_tilde, size = n, replace = TRUE)))
p_val <- switch(
alternative,
"two.sided" = mean(abs(boot_means - mu) >= abs(obs_mean - mu)),
"greater"   = mean(boot_means > obs_mean),
"less"      = mean(boot_means < obs_mean)
)
list(
obs_mean  = obs_mean,
boot_means = boot_means,
p_value   = p_val,
alternative = alternative
)
}
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu0 = 0, R = 10000, alternative = "greater", seed = 123)
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu = 0, R = 10000, alternative = "greater", seed = 123)
res_boot$obs_mean
res_boot$p_value
boot_test_mean <- function(
x,
mu = 0,
R = 5000,
alternative = c("two.sided", "greater", "less"),
seed = NULL
) {
alternative <- match.arg(alternative)
if (!is.null(seed)) set.seed(seed)
x <- x[!is.na(x)]
n <- length(x)
obs_mean <- mean(x)
x_tilde <- x - mean(x) + mu
# Bootstrap samples
boot_means <- replicate(R, mean(sample(x_tilde, size = n, replace = TRUE)))
p_val <- switch(
alternative,
"two.sided" = mean(abs(boot_means - mu) >= abs(obs_mean - mu)),
"greater"   = mean(boot_means > obs_mean),
"less"      = mean(boot_means < obs_mean)
)
list(
obs_mean  = obs_mean,
boot_means = boot_means,
p_value   = p_val,
alternative = alternative
)
}
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu = 0, R = 10000, alternative = "greater", seed = 123)
res_boot$obs_mean
res_boot$p_value
# Histogram phân phối bootstrap
hist(res_boot$boot_means, breaks = 50, col = "skyblue",
main = "Bootstrap Distribution of Mean Chlorine",
xlab = "Mean Chlorine")
abline(v = res_boot$obs_mean, col = "red", lwd = 2)
ggplot() +
geom_histogram(
aes(x = res_boot$boot_means),
bins  = 30,
fill  = "lightblue",
color = "white"
) +
geom_vline(
aes(xintercept = res_boot$obs_mean),
color     = "red",
linetype  = "dashed",
linewidth = 1
) +
theme_minimal() +
labs(
title = "Bootstrap Distribution of Mean Chlorine",
x     = "Bootstrap sample means",
y     = "Frequency"
)
# Histogram phân phối bootstrap
hist(res_boot$boot_means, breaks = 50, col = "skyblue",
main = "Bootstrap Distribution of Mean Chlorine",
xlab = "Mean Chlorine")
abline(v = res_boot$obs_mean, col = "red", lwd = 2)
ggplot() +
geom_histogram(
aes(x = res_boot$boot_means),
bins  = 30,
fill  = "lightblue",
color = "white"
) +
geom_vline(
aes(xintercept = res_boot$obs_mean),
color     = "red",
linetype  = "dashed",
linewidth = 1
) +
theme_minimal() +
labs(
title = "Bootstrap Distribution of Mean Chlorine",
x     = "Bootstrap sample means",
y     = "Frequency"
)
chlorine_data <- data_enviroment |>
filter(!is.na(Chlorine)) |>
pull(Chlorine)
res_boot <- boot_test_mean(chlorine_data, mu = 0, R = 10000, alternative = "two.sided", seed = 123)
res_boot$obs_mean
res_boot$p_value
ggplot() +
geom_histogram(
aes(x = res_boot$boot_means),
bins  = 30,
fill  = "lightblue",
color = "white"
) +
geom_vline(
aes(xintercept = res_boot$obs_mean),
color     = "red",
linetype  = "dashed",
linewidth = 1
) +
theme_minimal() +
labs(
title = "Bootstrap Distribution of Mean Chlorine",
x     = "Bootstrap sample means",
y     = "Frequency"
)
ggplot() +
geom_histogram(aes(x = res_boot$boot_means), bins = 30, fill = "lightblue", color = "white") +
geom_vline(xintercept = res_boot$obs_mean, color = "red", linetype = "dashed", linewidth = 1) +
geom_rect(aes(xmin = res_boot$obs_mean, xmax = max(res_boot$boot_means),
ymin = 0, ymax = Inf), fill = "red", alpha = 0.2) +
theme_minimal() +
labs(title = "Bootstrap Distribution of Mean Chlorine (p-value shaded)",
x = "Bootstrap sample means",
y = "Frequency")
ggplot() +
geom_histogram(aes(x = res_boot$boot_means), bins = 30, fill = "lightblue", color = "white") +
geom_vline(xintercept = res_boot$obs_mean, color = "red", linetype = "dashed", linewidth = 1) +
theme_minimal() +
labs(title = "Bootstrap Distribution of Mean Chlorine (p-value shaded)",
x = "Bootstrap sample means",
y = "Frequency")
boot_means <- res_boot$boot_means
ci_95 <- quantile(boot_means, probs = c(0.025, 0.975))
ci_95
# Bootstrap bias
bias_boot <- mean(res_boot$boot_means) - res_boot$obs_mean
bias_boot
# Tỉ số giữa SE bootstrap và SE lý thuyết
se_boot <- sd(res_boot$boot_means)
n <- length(chlorine_data)
se_theory <- sd(chlorine_data) / sqrt(n)
ratio_se <- se_boot / se_theory
ratio_se
